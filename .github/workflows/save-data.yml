name: List news urls containing global warming

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  click-here-to-see-data:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - name: Set up JDK 11
        uses: actions/setup-java@v2
        with:
          java-version: '11'
          distribution: 'adopt'
      - name: Set current date as env variable for partitioning
        run: echo "PATH_PARTITION=$(date -d "yesterday" +'year=%Y/month=%-m')" >> $GITHUB_ENV
      - name: Set last month as env variable for partitioning
        run: echo "PATH_LAST_MONTH_PARTITION=$(date -d "last month" +'year=%Y/month=%-m')" >> $GITHUB_ENV
      - name: List France 2 news urls containing global warming (see end)
        run: sbt "runMain com.github.polomarcus.main.TelevisionNewsAnalyser 1 france2"
      - name: Organize new data for France 2
        run: |
          ls -R output-france2-tv-news-json/
          mkdir -p data-news-json/media=France\ 2/${{ env.PATH_PARTITION }}
          mkdir -p output-france2-tv-news-json/media=France\ 2/${{ env.PATH_PARTITION }}
          mv -vn output-france2-tv-news-json/media=France\ 2/${{ env.PATH_PARTITION }}/** data-news-json/media=France\ 2/${{ env.PATH_PARTITION }}
          mv -vn output-france2-tv-news-json/media=France\ 2/${{ env.PATH_LAST_MONTH_PARTITION }}/** data-news-json/media=France\ 2/${{ env.PATH_LAST_MONTH_PARTITION }}
          ls -R data-news-json/media=France\ 2/${{ env.PATH_PARTITION }}
      - name: List new data for France 2
        run: |
            ls -R data-news-json/media=France\ 2/year=2022/
      - name: List TF1 news urls containing global warming (see end)
        run: sbt "runMain com.github.polomarcus.main.TelevisionNewsAnalyser 1 tf1"
      - name: List and organize new data for TF1
        run: |
          ls -R output-tf1-tv-news-json/
          mkdir -p data-news-json/media=TF1/${{ env.PATH_PARTITION }}
          mkdir -p output-tf1-tv-news-json/media=TF1/${{ env.PATH_PARTITION }}
          mv -vn output-tf1-tv-news-json/media=TF1/${{ env.PATH_PARTITION }}/** data-news-json/media=TF1/${{ env.PATH_PARTITION }}
          mv -vn output-tf1-tv-news-json/media=TF1/${{ env.PATH_LAST_MONTH_PARTITION }}/** data-news-json/media=TF1/${{ env.PATH_LAST_MONTH_PARTITION }}
          ls -R data-news-json/media=TF1/${{ env.PATH_PARTITION }}
      - name: List and organize new data for TF1
        run: |
          ls -R data-news-json/media=TF1/year=2022/
      - name: Website - Create aggregated news / latest news
        run: sbt "runMain com.github.polomarcus.main.UpdateNews"
      - name: List new data for website
        run: ls website/data-aggregated-news-json/agg.json/