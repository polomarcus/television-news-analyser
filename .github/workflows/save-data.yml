name: List news urls containing global warming

on:
  schedule: # https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#schedule
  - cron:  '18 18 * * *'


jobs:
  click-here-to-see-data:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - name: Set up JDK 11
        uses: actions/setup-java@v2
        with:
          java-version: '11'
          distribution: 'adopt'
      - name: Set current date as env variable for partitionning
        run: echo "PATH_PARTITION=$(date -d "yesterday" +'year=%Y/month=%-m')" >> $GITHUB_ENV
      - name: Echo current date
        run: echo "${{ env.PATH_PARTITION }}"
      - name: List France 2 news urls containing global warming (see end)
        run: sbt "runMain com.github.polomarcus.main.TelevisionNewsAnalyser 1 france2"
      - name: List new data fr2
        run: ls -R output-france2-tv-news-json/
      - name: create new folder data fr2
        run: mkdir -p data-news-json/media=France\ 2/${{ env.PATH_PARTITION }}
      - name: move new data fr2 to be saved
        run: mv -vn output-france2-tv-news-json/media=France\ 2/${{ env.PATH_PARTITION }}/** data-news-json/media=France\ 2/${{ env.PATH_PARTITION }}
      - name: List new data fr2
        run: ls data-news-json/media=France\ 2/${{ env.PATH_PARTITION }}
      - name: List TF1 news urls containing global warming (see end)
        run: sbt "runMain com.github.polomarcus.main.TelevisionNewsAnalyser 1 tf1"
      - name: List new data tf1
        run: ls -R output-tf1-tv-news-json/
      - name: create new folder data tf1
        run: mkdir -p data-news-json/media=TF1/${{ env.PATH_PARTITION }}
      - name: move new data tf1 to be saved
        run: mv -vn output-tf1-tv-news-json/media=TF1/${{ env.PATH_PARTITION }}/** data-news-json/media=TF1/${{ env.PATH_PARTITION }}
      - name: List new data tf1
        run: ls data-news-json/media=TF1/${{ env.PATH_PARTITION }}
      - name: List new data for website
        run: ls website/data-aggregated-news-json/agg.json/
      - uses: actions/checkout@v2
        with:
          clean: false
      - run: |
           git config user.name github-actions
           git config user.email github-actions@github.com
           git status
           git add data-news-json
           git add website
           git commit -m "ci(data): saved date ${{ env.PATH_PARTITION }}"
           git push origin main